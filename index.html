<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plantafel Dachdeckerei Frey</title>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header>Plantafel Dachdeckerei Frey</header>

<div id="page">

  <!-- Tabs -->
  <nav class="tabs">
    <button class="tab-btn active" data-tab="jahr">Jahresplanung</button>
    <button class="tab-btn" data-tab="woche">Wochenplan (4 KW)</button>
  </nav>

  <!-- TAB: JAHRESPLANUNG -->
  <div id="tab-jahr" class="tab-content active">
    <div class="section">
      <div class="section-header">
        <h2>Jahresübersicht (12 Monate)</h2>
        <span class="small-text">Karten per Drag & Drop verschieben – Datum bleibt unverändert.</span>
      </div>

      <div class="year-layout">
        <!-- Raster 4x3 Monate -->
        <table class="year-table" id="yearTable"></table>

        <!-- Rechte Kategorien-Spalte -->
        <div class="year-right-cols" id="yearCategories"></div>
      </div>
    </div>
  </div>

  <!-- TAB: WOCHENPLANUNG -->
  <div id="tab-woche" class="tab-content">

    <!-- LISTE -->
    <div class="section">
      <div class="section-header">
        <h2>Einträge (Liste)</h2>
        <span class="small-text">Klick auf eine Zeile lädt den Eintrag ins Formular.</span>
      </div>
      <div style="overflow-x:auto;">
        <table id="listTable">
          <thead>
          <tr>
            <th>Tag/Von</th>
            <th>Bis</th>
            <th>Titel</th>
            <th>Baustelle</th>
            <th>Mitarbeiter</th>
            <th>Fahrzeug</th>
            <th>Status</th>
          </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- FORMULAR -->
    <div class="section">
      <h2>Eintrag bearbeiten / neu anlegen</h2>
      <p class="small-text">
        KW + Wochentag steuern das Wochen-Board (4 KW). Bereich steuert das Jahresbrett (Monat / Kategorie).
      </p>
      <div class="form-grid">
        <div>
          <label>Tag (Info, optional):
            <input type="date" id="tagInput">
          </label>
        </div>
        <div>
          <label>Bereich (für Jahresbrett):
            <input type="text" id="bereichInput" placeholder="z.B. jan, pv, kleinigkeiten">
          </label>
        </div>

        <div>
          <label>Von (optional):
            <input type="date" id="vonInput">
          </label>
        </div>
        <div>
          <label>Bis (optional):
            <input type="date" id="bisInput">
          </label>
        </div>

        <div>
          <label>KW (für Wochenbrett):
            <input type="number" id="kwInput" min="1" max="53" placeholder="z.B. 49">
          </label>
        </div>
        <div>
          <label>Wochentag (für Wochenbrett):
            <select id="weekdayInput">
              <option value="">– bitte wählen –</option>
              <option value="mo">Montag</option>
              <option value="di">Dienstag</option>
              <option value="mi">Mittwoch</option>
              <option value="do">Donnerstag</option>
              <option value="fr">Freitag</option>
            </select>
          </label>
        </div>

        <div>
          <label>Titel:
            <input type="text" id="titelInput" placeholder="z.B. Dachsanierung Muster">
          </label>
        </div>
        <div>
          <label>Baustelle:
            <input type="text" id="baustelleInput" placeholder="Adresse / Kunde">
          </label>
        </div>

        <div>
          <label>Mitarbeiter:
            <input type="text" id="mitarbeiterInput" placeholder="z.B. Thomas, Kevin">
          </label>
        </div>
        <div>
          <label>Fahrzeug:
            <input type="text" id="fahrzeugInput" placeholder="z.B. Crafter Bus">
          </label>
        </div>

        <div>
          <label>Status:
            <input type="text" id="statusInput" placeholder="normal / Urlaub / krank / Schule / Fahr / ...">
          </label>
        </div>
        <div>
          <label>Notiz:
            <textarea id="notizInput" placeholder="Optionale Zusatzinfos"></textarea>
          </label>
        </div>
      </div>

      <div class="form-actions">
        <button class="btn" id="saveBtn">Speichern</button>
        <button class="btn danger" id="deleteBtn">Löschen</button>
        <button class="btn secondary" id="resetBtn">Formular leeren</button>
        <span class="small-text" id="statusInfo"></span>
      </div>
    </div>

    <!-- WOCHENBRETT (4 KW) -->
    <div class="section">
      <div class="section-header">
        <h2>Wochenplan – Magnettafel (4 Kalenderwochen)</h2>
        <span class="small-text">Drag & Drop verschiebt die Karte – es werden nur KW + Wochentag gespeichert, Datum bleibt unverändert.</span>
      </div>
      <div class="week-controls">
        <button class="btn secondary" id="weekPrevBtn">4 KW zurück</button>
        <button class="btn secondary" id="weekTodayBtn">Aktuelle KW</button>
        <button class="btn secondary" id="weekNextBtn">4 KW vor</button>
        <span class="small-text" id="weekCaption"></span>
      </div>
      <div style="overflow-x:auto;">
        <table class="week-table" id="weekTable"></table>
      </div>
    </div>

    <!-- URLAUB -->
    <div class="section">
      <div class="section-header">
        <h2>Urlaubsübersicht</h2>
        <span class="small-text">Status enthält „Urlaub“ → erscheint hier.</span>
      </div>
      <div id="urlaubView" class="urlaub-list"></div>
    </div>

    <!-- STAMMDATEN -->
    <div class="section">
      <div class="section-header">
        <h2>Stammdaten</h2>
        <span class="small-text">Farben steuern Farbstreifen auf den Magnetkarten.</span>
      </div>
      <div class="stamm-grid">
        <!-- Mitarbeiter -->
        <div>
          <h3>Mitarbeiter</h3>
          <div class="form-grid">
            <div>
              <label>Name:
                <input type="text" id="maNameInput" placeholder="z.B. Thomas">
              </label>
            </div>
            <div>
              <label>Farbe:
                <input type="color" id="maColorInput" value="#ffcc00">
              </label>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn" id="maSaveBtn">Mitarbeiter speichern</button>
            <button class="btn secondary" id="maNewBtn">Neu</button>
            <button class="btn danger" id="maDeleteBtn">Löschen</button>
            <input type="hidden" id="maIdHidden">
          </div>

          <table class="stamm-table" id="maTable">
            <thead>
            <tr><th>Name</th><th>Farbe</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Fahrzeuge -->
        <div>
          <h3>Fahrzeuge</h3>
          <div class="form-grid">
            <div>
              <label>Bezeichnung:
                <input type="text" id="fzNameInput" placeholder="z.B. Crafter Bus">
              </label>
            </div>
            <div>
              <label>Kennzeichen:
                <input type="text" id="fzKennzInput" placeholder="z.B. EI-XY 123">
              </label>
            </div>
            <div>
              <label>Farbe:
                <input type="color" id="fzColorInput" value="#ff0000">
              </label>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn" id="fzSaveBtn">Fahrzeug speichern</button>
            <button class="btn secondary" id="fzNewBtn">Neu</button>
            <button class="btn danger" id="fzDeleteBtn">Löschen</button>
            <input type="hidden" id="fzIdHidden">
          </div>

          <table class="stamm-table" id="fzTable">
            <thead>
            <tr><th>Bezeichnung</th><th>Kennzeichen</th><th>Farbe</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

  </div><!-- /tab-woche -->

</div><!-- /page -->

<!-- Skripte -->
<script src="utils.js" defer></script>
<script src="supabase.js" defer></script>
<script src="app.js" defer></script>

</body>
</html>
