<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plantafel Dachdeckerei Frey</title>

  <!-- Supabase Library (Edge-sicher, funktioniert IMMER) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.39.4/dist/umd/supabase.min.js"></script>

  <!-- Stylesheet -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>Plantafel Dachdeckerei Frey</header>

<div id="page">

  <!-- Tabs -->
  <nav class="tabs">
    <button class="tab-btn active" data-tab="jahr">Jahresplanung</button>
    <button class="tab-btn" data-tab="woche">Wochenplan (4 KW)</button>
  </nav>

  <!-- JAHRESPLANUNG -->
  <div id="tab-jahr" class="tab-content active">
    <div class="section">
      <div class="section-header">
        <h2>Jahresübersicht (12 Monate)</h2>
        <span class="small-text">Karten per Drag & Drop verschieben.</span>
      </div>

      <div class="year-layout">
        <table class="year-table" id="yearTable"></table>
        <div class="year-right-cols" id="yearCategories"></div>
      </div>
    </div>
  </div>

  <!-- WOCHENPLAN -->
  <div id="tab-woche" class="tab-content">

    <!-- LISTE -->
    <div class="section">
      <div class="section-header">
        <h2>Einträge (Liste)</h2>
        <span class="small-text">Zum Bearbeiten auf eine Zeile klicken.</span>
      </div>

      <div style="overflow-x:auto;">
        <table id="listTable">
          <thead>
            <tr>
              <th>Tag/Von</th>
              <th>Bis</th>
              <th>Titel</th>
              <th>Baustelle</th>
              <th>Mitarbeiter</th>
              <th>Fahrzeug</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- FORMULAR -->
    <div class="section">
      <h2>Eintrag bearbeiten / neu anlegen</h2>

      <div class="form-grid">
        <div>
          <label>Tag:
            <input type="date" id="tagInput">
          </label>
        </div>

        <div>
          <label>Bereich (Jahr):
            <input type="text" id="bereichInput" placeholder="jan, feb, mär, pv …">
          </label>
        </div>

        <div>
          <label>Von:
            <input type="date" id="vonInput">
          </label>
        </div>

        <div>
          <label>Bis:
            <input type="date" id="bisInput">
          </label>
        </div>

        <div>
          <label>KW:
            <input type="number" id="kwInput" min="1" max="53">
          </label>
        </div>

        <div>
          <label>Wochentag:
            <select id="weekdayInput">
              <option value="">–</option>
              <option value="mo">Montag</option>
              <option value="di">Dienstag</option>
              <option value="mi">Mittwoch</option>
              <option value="do">Donnerstag</option>
              <option value="fr">Freitag</option>
            </select>
          </label>
        </div>

        <div>
          <label>Titel:
            <input type="text" id="titelInput">
          </label>
        </div>

        <div>
          <label>Baustelle:
            <input type="text" id="baustelleInput">
          </label>
        </div>

        <div>
          <label>Mitarbeiter:
            <input type="text" id="mitarbeiterInput">
          </label>
        </div>

        <div>
          <label>Fahrzeug:
            <input type="text" id="fahrzeugInput">
          </label>
        </div>

        <div>
          <label>Status:
            <input type="text" id="statusInput">
          </label>
        </div>

        <div>
          <label>Notiz:
            <textarea id="notizInput"></textarea>
          </label>
        </div>
      </div>

      <div class="form-actions">
        <button class="btn" id="saveBtn">Speichern</button>
        <button class="btn danger" id="deleteBtn">Löschen</button>
        <button class="btn secondary" id="resetBtn">Formular leeren</button>
        <span id="statusInfo" class="small-text"></span>
      </div>
    </div>

    <!-- WOCHENBRETT 4 KW -->
    <div class="section">
      <div class="section-header">
        <h2>Wochenplan – 4 Kalenderwochen</h2>
      </div>

      <div class="week-controls">
        <button class="btn secondary" id="weekPrevBtn">4 KW zurück</button>
        <button class="btn secondary" id="weekTodayBtn">Aktuelle KW</button>
        <button class="btn secondary" id="weekNextBtn">4 KW vor</button>
        <span id="weekCaption" class="small-text"></span>
      </div>

      <div style="overflow-x:auto;">
        <table class="week-table" id="weekTable"></table>
      </div>
    </div>

    <!-- URLAUB -->
    <div class="section">
      <div class="section-header">
        <h2>Urlaubsübersicht</h2>
      </div>
      <div id="urlaubView"></div>
    </div>

    <!-- STAMMDATEN -->
    <div class="section">
      <div class="section-header">
        <h2>Stammdaten</h2>
      </div>

      <div class="stamm-grid">
        <!-- Mitarbeiter -->
        <div>
          <h3>Mitarbeiter</h3>
          <div class="form-grid">
            <div><label>Name:<input type="text" id="maNameInput"></label></div>
            <div><label>Farbe:<input type="color" id="maColorInput" value="#ffcc00"></label></div>
          </div>
          <div class="form-actions">
            <button class="btn" id="maSaveBtn">Speichern</button>
            <button class="btn secondary" id="maNewBtn">Neu</button>
            <button class="btn danger" id="maDeleteBtn">Löschen</button>
            <input type="hidden" id="maIdHidden">
          </div>
          <table id="maTable" class="stamm-table">
            <thead><tr><th>Name</th><th>Farbe</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Fahrzeuge -->
        <div>
          <h3>Fahrzeuge</h3>
          <div class="form-grid">
            <div><label>Bezeichnung:<input type="text" id="fzNameInput"></label></div>
            <div><label>Kennzeichen:<input type="text" id="fzKennzInput"></label></div>
            <div><label>Farbe:<input type="color" id="fzColorInput" value="#ff0000"></label></div>
          </div>
          <div class="form-actions">
            <button class="btn" id="fzSaveBtn">Speichern</button>
            <button class="btn secondary" id="fzNewBtn">Neu</button>
            <button class="btn danger" id="fzDeleteBtn">Löschen</button>
            <input type="hidden" id="fzIdHidden">
          </div>
          <table id="fzTable" class="stamm-table">
            <thead><tr><th>Bezeichnung</th><th>Kennzeichen</th><th>Farbe</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- SCRIPT FILES -->
<script src="utils.js" defer></script>
<script src="supabase.js" defer></script>
<script src="app.js" defer></script>

</body>
</html>
