<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plantafel Dachdeckerei Frey</title>
  
  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root {
      --blue: #0075c9;
      --blue-dark: #005a99;
      --bg: #f0f0f0;
      --card-border: #000000;
      --text-main: #222;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    header {
      background: var(--blue);
      color: #fff;
      padding: 14px 18px;
      font-size: 22px;
      font-weight: bold;
    }

    #container {
      padding: 12px 12px 40px;
      max-width: 1400px;
      margin: 0 auto;
    }

    h1, h2, h3 {
      margin: 0 0 10px;
      font-weight: bold;
    }

    .section {
      background: #ffffff;
      margin-bottom: 14px;
      padding: 12px;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .small-text {
      font-size: 12px;
      color: #666;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 5px 6px;
      vertical-align: top;
    }

    th {
      background: #e7e7e7;
      font-weight: 600;
      text-align: left;
    }

    .btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      background: var(--blue);
      color: #fff;
      margin-right: 4px;
      margin-top: 4px;
    }

    .btn.secondary { background: #777; }
    .btn.danger { background: #b00020; }
    .btn:hover { background: var(--blue-dark); }
    .btn.secondary:hover { background: #555; }
    .btn.danger:hover { background: #870018; }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
    }

    input[type="text"], input[type="date"], textarea {
      width: 100%;
      padding: 4px 6px;
      font-size: 13px;
      border-radius: 3px;
      border: 1px solid #bbb;
    }

    textarea {
      resize: vertical;
      min-height: 50px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 16px;
    }

    .form-actions { margin-top: 8px; }

    .status-badge {
      display: inline-block;
      padding: 1px 6px;
      border-radius: 10px;
      border: 1px solid #555;
      font-size: 11px;
      margin-top: 2px;
    }

    /* Magnetkarten */
    .card {
      border: 2px solid var(--card-border);
      background: #ffffff;
      padding: 3px 4px;
      margin-bottom: 3px;
      font-size: 11px;
      line-height: 1.2;
      min-height: 34px;
    }

    .card-title {
      font-weight: bold;
      text-transform: uppercase;
      border-bottom: 1px solid #000;
      margin-bottom: 2px;
      padding-bottom: 1px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-line, .card-meta {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 10px;
    }

    /* Feinplanung */
    .fine-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      font-size: 11px;
    }

    .fine-table th, .fine-table td {
      border: 1px solid #d0d0d0;
      vertical-align: top;
      padding: 3px;
    }

    .fine-day-cell { min-height: 60px; }

    .fine-controls { margin-bottom: 8px; }

    /* Grobplanung */
    .grob-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 8px;
      font-size: 11px;
    }

    .grob-month {
      border: 1px solid #d0d0d0;
      border-radius: 4px;
      padding: 4px;
      background: #fafafa;
    }

    .grob-month-title {
      font-weight: bold;
      text-align: center;
      margin-bottom: 4px;
      font-size: 12px;
    }

    .grob-item {
      border: 1px solid #ccc;
      padding: 2px 3px;
      margin-bottom: 2px;
      background: #fff;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Urlaub */
    .urlaub-list table { font-size: 12px; }

    /* Responsive */
    @media (max-width: 900px) {
      .form-grid { grid-template-columns: 1fr; }
      header { font-size: 18px; }
      .fine-table { font-size: 10px; }
      .card { font-size: 10px; }
    }
  </style>
</head>
<body>
<header>Plantafel Dachdeckerei Frey</header>

<nav class="tabs">
  <button class="tab-btn active" data-tab="jahr">Jahresplanung</button>
  <button class="tab-btn" data-tab="woche">Wochenplanung</button>
</nav>

<div id="container">

  <!-- TAB: JAHRESPLANUNG -->
  <div id="tab-jahr" class="tab-content active">
    <div class="section">
      <div class="section-header">
        <h2>Jahresübersicht (wie großes Board)</h2>
        <span class="small-text">Karten frei per Drag & Drop verschieben – Datum wird nicht verändert.</span>
      </div>

      <div class="year-layout">
        <!-- Raster 4x3 Monate -->
        <table class="year-table" id="yearTable"></table>

        <!-- Rechte Kategorien-Spalte -->
        <div class="year-right-cols" id="yearCategories"></div>
      </div>
    </div>
  </div>
      <div id="jahresRechtsSpalten"></div>
    </div>
  </div>

  <!-- TAB: WOCHENPLANUNG -->
  <div id="tab-woche" class="tab-content">
    <!-- LISTE -->
    <div class="section">
      <div class="section-header">
        <h2>Einträge (Liste)</h2>
        <span class="small-text">Klick auf eine Zeile lädt den Eintrag ins Formular.</span>
      </div>
      <div style="overflow-x:auto;">
        <table id="listTable">
          <thead>
          <tr>
            <th>Tag/Von</th><th>Bis</th><th>Titel</th><th>Baustelle</th><th>Mitarbeiter</th><th>Fahrzeug</th><th>Status</th>
          </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- FORMULAR -->
    <div class="section">
      <h2>Eintrag bearbeiten / neu anlegen</h2>
      <div class="form-grid">
        <div><label>Tag<input type="date" id="tagInput"></label></div>
        <div></div>
        <div><label>Von<input type="date" id="vonInput"></label></div>
        <div><label>Bis<input type="date" id="bisInput"></label></div>
        <div><label>Titel<input type="text" id="titelInput"></label></div>
        <div><label>Baustelle<input type="text" id="baustelleInput"></label></div>
        <div><label>Mitarbeiter<input type="text" id="mitarbeiterInput"></label></div>
        <div><label>Fahrzeug<input type="text" id="fahrzeugInput"></label></div>
        <div><label>Status<input type="text" id="statusInput"></label></div>
        <div><label>Notiz<textarea id="notizInput"></textarea></label></div>
      </div>
      <div class="form-actions">
        <button class="btn" id="saveBtn">Speichern</button>
        <button class="btn danger" id="deleteBtn">Löschen</button>
        <button class="btn secondary" id="resetBtn">Formular leeren</button>
        <span id="statusInfo" class="small-text"></span>
      </div>
    </div>

    <!-- FEINPLANUNG / MAGNETTAFEL -->
    <div class="section">
      <div class="section-header">
        <h2>Feinplanung – Magnettafel</h2>
      </div>
      <div class="fine-controls">
        <button class="btn" data-span="7" id="btn1w">1 Woche</button>
        <button class="btn" data-span="14" id="btn2w">2 Wochen</button>
        <button class="btn" data-span="28" id="btn4w">4 Wochen</button>
        <button class="btn" id="btnPrev">Zurück</button>
        <button class="btn" id="btnToday">Diese Woche</button>
        <button class="btn" id="btnNext">Weiter</button>
        <span class="small-text" id="fineCaption"></span>
      </div>
      <div style="overflow-x:auto;">
        <table class="fine-table" id="fineTable"></table>
      </div>
    </div>

  </div>

</div>

<script>
// Tab-Umschaltung
const tabButtons = document.querySelectorAll('.tab-btn');
const tabs = document.querySelectorAll('.tab-content');

tabButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    tabButtons.forEach(b => b.classList.remove('active'));
    tabs.forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
  });
});
</script>
    <div style="overflow-x:auto;">
      <table id="listTable">
        <thead>
          <tr>
            <th>Tag/Von</th>
            <th>Bis</th>
            <th>Titel</th>
            <th>Baustelle</th>
            <th>Mitarbeiter</th>
            <th>Fahrzeug</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- FORMULAR -->
  <div class="section">
    <h2>Eintrag bearbeiten / neu anlegen</h2>
    <div class="form-grid">
      <div><label>Tag<input type="date" id="tagInput"></label></div>
      <div></div>
      <div><label>Von<input type="date" id="vonInput"></label></div>
      <div><label>Bis<input type="date" id="bisInput"></label></div>
      <div><label>Titel<input type="text" id="titelInput"></label></div>
      <div><label>Baustelle<input type="text" id="baustelleInput"></label></div>
      <div><label>Mitarbeiter<input type="text" id="mitarbeiterInput"></label></
