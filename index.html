<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Plantafel Digital</title>

  <style>
    :root {
      --bg-main: #0f1117;
      --bg-card: #1f242f;
      --bg-card-border: #323a4a;
      --bg-toolbar: #1a1d27;
      --text-main: #fff;
      --text-dim: #9ca3af;
      --accent: #3b82f6;
      --accent-bg: #1e40af;
      --danger: #ef4444;
      --radius-lg: 10px;
      --radius-sm: 6px;
      --gap: 8px;
      --font-stack: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
    }

    * {
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
    }

    body {
      margin: 0;
      background-color: var(--bg-main);
      color: var(--text-main);
      font-family: var(--font-stack);
      font-size: 14px;
      line-height: 1.4;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header.toolbar {
      background-color: var(--bg-toolbar);
      border-bottom: 1px solid var(--bg-card-border);
      padding: 8px 12px;
      display: flex;
      flex-wrap: wrap;
      gap: var(--gap);
      align-items: center;
      font-size: 14px;
    }

    header.toolbar .left,
    header.toolbar .right {
      display: flex;
      flex-wrap: wrap;
      gap: var(--gap);
      align-items: center;
    }

    .chip {
      background-color: var(--bg-card);
      border: 1px solid var(--bg-card-border);
      border-radius: var(--radius-sm);
      padding: 8px 10px;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 8px;
      min-height: 36px;
    }

    .chip.green-dot::before {
      content: "";
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #10b981;
      display: inline-block;
    }

    label.lbl {
      font-size: 13px;
      color: var(--text-dim);
      margin-right: 4px;
      white-space: nowrap;
    }

    select,
    input[type="date"],
    input[type="text"] {
      background-color: var(--bg-card);
      color: var(--text-main);
      border: 1px solid var(--bg-card-border);
      border-radius: var(--radius-sm);
      padding: 8px 10px;
      font-size: 14px;
      min-height: 36px;
    }

    input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: var(--accent);
    }

    button.primary {
      background-color: var(--accent);
      color: #fff;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 500;
      padding: 8px 12px;
      min-height: 36px;
      cursor: pointer;
    }

    button.ghost {
      background-color: var(--bg-card);
      border: 1px solid var(--bg-card-border);
      color: var(--text-main);
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 500;
      padding: 8px 12px;
      min-height: 36px;
      cursor: pointer;
    }

    main {
      flex: 1;
      padding: 12px;
      display: flex;
      flex-direction: column;
    }

    /* Grid */
    .board-grid {
      display: grid;
      gap: var(--gap);
    }

    /* Standard: 5 Tage (Mo-Fr) */
    .board-grid.five-cols {
      grid-template-columns: repeat(5, minmax(200px, 1fr));
    }

    /* Karte (Tag / Auftragsspalte) */
    .day-col {
      background-color: var(--bg-card);
      border: 1px solid var(--bg-card-border);
      border-radius: var(--radius-lg);
      display: flex;
      flex-direction: column;
      min-height: 220px;
    }

    .day-head {
      border-bottom: 1px solid var(--bg-card-border);
      padding: 8px 10px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      row-gap: 4px;
      font-size: 13px;
    }
    .day-head .leftblock {
      display: flex;
      flex-direction: column;
      color: var(--text-main);
    }
    .day-head .kw {
      color: var(--accent);
      font-weight: 500;
      font-size: 12px;
    }
    .day-head .date-line {
      font-size: 12px;
      color: var(--text-dim);
    }

    .day-head .actions {
      display: flex;
      gap: 4px;
      align-items: center;
    }
    .mini-btn {
      background-color: transparent;
      border: 1px solid var(--bg-card-border);
      color: var(--text-dim);
      border-radius: 4px;
      font-size: 12px;
      line-height: 1;
      padding: 2px 4px;
      cursor: pointer;
    }
    .mini-btn.danger {
      color: var(--danger);
      border-color: var(--danger);
    }

    .dropzone {
      flex: 1;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 12px;
      color: var(--text-dim);
    }

    /* Eintrag / Auftrag */
    .card {
      background-color: rgba(59,130,246,0.08);
      border: 1px solid var(--accent);
      color: var(--text-main);
      border-radius: var(--radius-sm);
      padding: 8px;
      font-size: 13px;
      line-height: 1.4;
      cursor: grab;
      position: relative;
    }
    .card[data-status="rot"] {
      background-color: rgba(239,68,68,0.15);
      border-color: var(--danger);
    }

    .card-title {
      font-weight: 600;
      margin-bottom: 4px;
      word-break: break-word;
    }
    .card-meta {
      font-size: 12px;
      color: var(--text-dim);
      display: flex;
      flex-wrap: wrap;
      gap:4px;
    }

    /* FAB bottom-right (+) */
    .fab {
      position: fixed;
      right: 16px;
      bottom: 16px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background-color: var(--accent);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      font-weight: 500;
      line-height: 0;
      cursor: pointer;
      box-shadow: 0 10px 25px rgba(0,0,0,0.6);
      user-select: none;
    }

    /* Dialog Overlays */
    dialog {
      background-color: var(--bg-card);
      color: var(--text-main);
      border: 1px solid var(--bg-card-border);
      border-radius: var(--radius-lg);
      max-width: 400px;
      width: calc(100% - 32px);
      padding:16px;
      font-size:14px;
    }
    dialog::backdrop {
      background-color: rgba(0,0,0,0.6);
    }

    .dlg-head {
      font-weight:600;
      margin-bottom:12px;
      font-size:15px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .dlg-body {
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-bottom:16px;
    }
    .dlg-row {
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .dlg-row label {
      font-size:13px;
      color:var(--text-dim);
    }
    .dlg-row input,
    .dlg-row select,
    .dlg-row textarea {
      background-color: var(--bg-main);
      color: var(--text-main);
      border:1px solid var(--bg-card-border);
      border-radius:var(--radius-sm);
      padding:8px 10px;
      font-size:14px;
      min-height:36px;
      font-family:inherit;
    }
    .dlg-row textarea {
      min-height:70px;
      resize:vertical;
    }

    .dlg-foot {
      display:flex;
      justify-content:flex-end;
      gap:8px;
    }

    footer.statusbar {
      font-size:12px;
      color:var(--text-dim);
      padding:6px 10px 10px;
      text-align:left;
    }

    @media(max-width:900px){
      .board-grid.five-cols{
        grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
      }
    }
  </style>
</head>
<body>

  <header class="toolbar">
    <div class="left">
      <div class="chip green-dot" id="connChip">verbunden</div>

      <div class="chip">
        <div class="lbl-wrap">
          <label class="lbl" for="viewSel">Ansicht:</label>
        </div>
        <select id="viewSel">
          <option value="4w">4 Wochen (Mo–Fr)</option>
          <option value="2w">14 Tage</option>
          <option value="12m">12 Monate</option>
        </select>
      </div>

      <div class="chip">
        <div class="lbl-wrap">
          <label class="lbl" for="startDate">Start:</label>
        </div>
        <input type="date" id="startDate" />
      </div>

      <button class="ghost" id="btnReload">Neu laden</button>

      <div class="chip" title="Urlaub / Krank / Schule farblich markieren">
        <input type="checkbox" id="chkSpecial" />
        <label for="chkSpecial">Urlaub/Krank/Schule</label>
      </div>

      <div class="chip">
        <input type="checkbox" id="chkAuto" />
        <label for="chkAuto">Auto-Reload</label>
      </div>

      <button class="ghost" id="btnSettings">Stammdaten</button>

      <button class="primary" id="btnAdd">+ Eintrag</button>
    </div>
  </header>

  <main>
    <div id="gridContainer" class="board-grid five-cols"></div>
  </main>

  <footer class="statusbar">
    Status rot = Urlaub/Krank/Schule
  </footer>

  <div class="fab" id="fabPlus">+</div>

  <!-- Dialog: Neuer Eintrag / Bearbeiten -->
  <dialog id="entryDlg">
    <div class="dlg-head">
      <span id="dlgTitle">Neuer Eintrag</span>
      <button class="mini-btn danger" id="btnDelete" style="display:none;">X</button>
    </div>
    <div class="dlg-body">
      <div class="dlg-row">
        <label for="inTitle">Titel / Projekt</label>
        <input id="inTitle" placeholder="z.B. Dachsanierung Müller" />
      </div>
      <div class="dlg-row">
        <label for="inNote">Notiz</label>
        <textarea id="inNote" placeholder="Details / Adresse / Besonderheiten"></textarea>
      </div>
      <div class="dlg-row">
        <label for="inDate">Tag</label>
        <input type="date" id="inDate" />
      </div>
      <div class="dlg-row">
        <label for="inStatus">Status / Farbe</label>
        <select id="inStatus">
          <option value="normal">Normal</option>
          <option value="rot">Urlaub / Krank / Schule</option>
        </select>
      </div>
      <div class="dlg-row">
        <label for="inTeam">Team / Mitarbeiter</label>
        <input id="inTeam" placeholder="z.B. Patrick, Herbert" />
      </div>
    </div>
    <div class="dlg-foot">
      <button class="ghost" id="btnCancel">Abbrechen</button>
      <button class="primary" id="btnSave">Speichern</button>
    </div>
  </dialog>

  <!-- Dialog: Stammdaten -->
  <dialog id="masterDlg">
    <div class="dlg-head">
      <span>Stammdaten</span>
      <button class="ghost" id="btnMasterClose">Schließen</button>
    </div>
    <div class="dlg-body">
      <p style="font-size:13px;color:var(--text-dim);margin:0;">
        (Mitarbeiter, Fahrzeuge usw. – kommt direkt aus Firestore-Collection "settings")
      </p>
      <div id="masterList" style="font-size:13px;color:var(--text-main);line-height:1.5;"></div>

      <div class="dlg-row">
        <label for="mType">Typ</label>
        <select id="mType">
          <option value="mitarbeiter">Mitarbeiter</option>
          <option value="fahrzeug">Fahrzeug</option>
        </select>
      </div>
      <div class="dlg-row">
        <label for="mName">Bezeichnung</label>
        <input id="mName" placeholder="z.B. Patrick / Sprinter Bus" />
      </div>
    </div>
    <div class="dlg-foot">
      <button class="ghost" id="btnMasterCancel">Abbrechen</button>
      <button class="primary" id="btnMasterSave">Speichern</button>
    </div>
  </dialog>

  <script type="module">
    // Firebase v11 ohne App Check
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getFirestore, collection, doc,
      getDocs, getDoc, addDoc, setDoc, updateDoc, deleteDoc,
      query, where, orderBy, onSnapshot, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // --- Deine Config (aus der Konsole) ---
    const firebaseConfig = {
      apiKey: "AIzaSyDpWF-XnO23Bx-eBCVg6642D7xm9f4SxDI",
      authDomain: "plantafelfreyllich100.firebaseapp.com",
      projectId: "plantafelfreyllich100",
      storageBucket: "plantafelfreyllich100.appspot.com",
      messagingSenderId: "96295913315",
      appId: "1:96295913315:web:e4462794478f15c0ef914da",
      measurementId: "G-W5GVSSLTRC"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // ---------------------------
    // Hilfsfunktionen Formatierung
    // ---------------------------

    function pad2(num){
      return num.toString().padStart(2,"0");
    }
    function ymd(d){
      return d.getFullYear()+"-"+pad2(d.getMonth()+1)+"-"+pad2(d.getDate());
    }
    function addDays(d, n){
      const c = new Date(d);
      c.setDate(c.getDate()+n);
      return c;
    }
    function getKW(date){
      // ISO Kalenderwoche
      const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
      const dayNum = d.getUTCDay() || 7;
      d.setUTCDate(d.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
      const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1)/7);
      return "KW " + weekNo;
    }

    // ---------------------------
    // DOM Referenzen
    // ---------------------------
    const gridContainer   = document.getElementById("gridContainer");
    const viewSel         = document.getElementById("viewSel");
    const startDateInput  = document.getElementById("startDate");
    const chkSpecial      = document.getElementById("chkSpecial");
    const chkAuto         = document.getElementById("chkAuto");
    const btnReload       = document.getElementById("btnReload");
    const btnSettings     = document.getElementById("btnSettings");
    const btnAdd          = document.getElementById("btnAdd");
    const fabPlus         = document.getElementById("fabPlus");

    // Dialog refs
    const entryDlg        = document.getElementById("entryDlg");
    const dlgTitle        = document.getElementById("dlgTitle");
    const btnDelete       = document.getElementById("btnDelete");
    const inTitle         = document.getElementById("inTitle");
    const inNote          = document.getElementById("inNote");
    const inDate          = document.getElementById("inDate");
    const inStatus        = document.getElementById("inStatus");
    const inTeam          = document.getElementById("inTeam");
    const btnCancel       = document.getElementById("btnCancel");
    const btnSave         = document.getElementById("btnSave");

    // Stammdaten-Dialog
    const masterDlg       = document.getElementById("masterDlg");
    const btnMasterClose  = document.getElementById("btnMasterClose");
    const btnMasterCancel = document.getElementById("btnMasterCancel");
    const btnMasterSave   = document.getElementById("btnMasterSave");
    const masterList      = document.getElementById("masterList");
    const mType           = document.getElementById("mType");
    const mName           = document.getElementById("mName");

    // ---------------------------
    // State
    // ---------------------------
    let currentView   = "4w";        // 4w / 2w / 12m
    let currentStart  = new Date();  // Startdatum
    let autoReloadId  = null;
    let liveUnsubFns  = [];          // aktive Firestore onSnapshot unsubscribes
    let editDocRef    = null;        // beim Bearbeiten: doc ref des Eintrags

    // initial Start-Datum ins Feld schreiben
    startDateInput.value = ymd(currentStart);

    // ---------------------------
    // Board aufbauen (Spalten rendern + Live Daten anhängen)
    // ---------------------------

    async function buildBoard(){
      // Alte Listener stoppen
      liveUnsubFns.forEach(fn => { try{fn();}catch(e){} });
      liveUnsubFns = [];

      gridContainer.innerHTML = "";

      // Ansicht auswerten → wie viele Tage zeigen wir?
      let daysToShow = 20; // fallback
      if(currentView==="4w"){ daysToShow = 20; }     // Mo-Fr über 4 Wochen = 20 Werktage
      if(currentView==="2w"){ daysToShow = 10; }     // 2 Wochen Mo-Fr
      if(currentView==="12m"){ daysToShow = 365; }   // grob (wir machen es einfach erstmal flach)

      // Wir rendern pro Tag eine Spalte (vereinfacht). In der alten Version hattest du gruppiert nach KW.
      // Ich mache: nur Werktage (Mo-Fr), weil du "Mo-Fr" im Dropdown hattest.
      const cols = [];
      let d = new Date(currentStart);

      while(cols.length < daysToShow){
        const dow = d.getDay(); // 1..5 = Mo-Fr
        if(dow>=1 && dow<=5){
          cols.push(new Date(d));
        }
        d = addDays(d,1);
      }

      // Grid-Layout Klassen setzen (5 Spalten Style bleibt erstmal, responsive macht den Rest)
      gridContainer.classList.add("five-cols");

      // Für jede Spalte ein DOM-Element bauen
      for(const dayDate of cols){
        const dayYMD = ymd(dayDate);

        const colDiv = document.createElement("div");
        colDiv.className = "day-col";
        colDiv.dataset.day = dayYMD;

        // Kopf
        const headDiv = document.createElement("div");
        headDiv.className = "day-head";

        const leftblock = document.createElement("div");
        leftblock.className = "leftblock";

        const kwLine = document.createElement("div");
        kwLine.className = "kw";
        kwLine.textContent = getKW(dayDate) + " " + ["So","Mo","Di","Mi","Do","Fr","Sa"][dayDate.getDay()];
        leftblock.appendChild(kwLine);

        const dline = document.createElement("div");
        dline.className = "date-line";
        dline.textContent = dayYMD;
        leftblock.appendChild(dline);

        headDiv.appendChild(leftblock);

        const actionsDiv = document.createElement("div");
        actionsDiv.className = "actions";

        // mini "X" kommt erst sichtbar beim Editieren jeder Karte, nicht global
        // aber ich gebe hier z.B. einen Dummy Button für "Neu hier"
        const addMini = document.createElement("button");
        addMini.className = "mini-btn";
        addMini.textContent = "+";
        addMini.title = "Neuen Eintrag an diesem Tag erstellen";
        addMini.addEventListener("click", () => {
          openEntryDialog({
            title:"",
            note:"",
            date: dayYMD,
            status:"normal",
            team:""
          }, null);
        });
        actionsDiv.appendChild(addMini);

        headDiv.appendChild(actionsDiv);

        colDiv.appendChild(headDiv);

        // Dropzone
        const dz = document.createElement("div");
        dz.className = "dropzone";
        dz.dataset.day = dayYMD;
        dz.textContent = "Klicken zum Eintragen - Drag & Drop möglich";
        dz.addEventListener("click", () => {
          openEntryDialog({
            title:"",
            note:"",
            date: dayYMD,
            status:"normal",
            team:""
          }, null);
        });

        // Drag&Drop Ziel erlauben
        dz.addEventListener("dragover", (ev)=>{
          ev.preventDefault();
          dz.style.outline = "2px solid var(--accent)";
        });
        dz.addEventListener("dragleave", ()=>{
          dz.style.outline = "none";
        });
        dz.addEventListener("drop", async(ev)=>{
          ev.preventDefault();
          dz.style.outline = "none";
          const movedId = ev.dataTransfer.getData("text/plain");
          if(movedId){
            // Eintrag auf neuen Tag verschieben
            const ref = doc(db,"plantafel", movedId);
            await updateDoc(ref,{
              date: dayYMD,
              movedAt: serverTimestamp()
            });
          }
        });

        colDiv.appendChild(dz);

        gridContainer.appendChild(colDiv);

        // Live Listener für alle Einträge mit genau diesem date
        const qRef = query(
          collection(db,"plantafel"),
          where("date","==", dayYMD),
          orderBy("title")
        );

        const unsub = onSnapshot(qRef, snap=>{
          // Dropzone Inhalt neu rendern
          dz.innerHTML = "";
          snap.forEach(docSnap=>{
            const data = docSnap.data();
            const cardDiv = renderCard(docSnap.id, data);
            dz.appendChild(cardDiv);
          });
          if(!dz.childNodes.length){
            dz.textContent = "Klicken zum Eintragen - Drag & Drop möglich";
          }
        });

        liveUnsubFns.push(unsub);
      }
    }

    function renderCard(id, data){
      const c = document.createElement("div");
      c.className = "card";
      if(data.status==="rot"){
        c.dataset.status = "rot";
      }
      c.draggable = true;
      c.addEventListener("dragstart",(ev)=>{
        ev.dataTransfer.setData("text/plain", id);
      });

      c.addEventListener("click", ()=>{
        openEntryDialog({
          title: data.title || "",
          note: data.note || "",
          date: data.date || ymd(new Date()),
          status: data.status || "normal",
          team: data.team || ""
        }, id);
      });

      const head = document.createElement("div");
      head.className = "card-title";
      head.textContent = data.title || "(ohne Titel)";
      c.appendChild(head);

      const meta = document.createElement("div");
      meta.className = "card-meta";
      if(data.team){
        const spanTeam = document.createElement("span");
        spanTeam.textContent = data.team;
        meta.appendChild(spanTeam);
      }
      if(data.note){
        const spanNote = document.createElement("span");
        spanNote.textContent = data.note;
        meta.appendChild(spanNote);
      }
      c.appendChild(meta);

      return c;
    }

    // ---------------------------
    // Dialog Neuer Eintrag / Bearbeiten
    // ---------------------------

    function openEntryDialog(values, docId){
      editDocRef = docId ? doc(db,"plantafel",docId) : null;

      dlgTitle.textContent = docId ? "Eintrag bearbeiten" : "Neuer Eintrag";
      btnDelete.style.display = docId ? "inline-block" : "none";

      inTitle.value  = values.title  || "";
      inNote.value   = values.note   || "";
      inDate.value   = values.date   || ymd(new Date());
      inStatus.value = values.status || "normal";
      inTeam.value   = values.team   || "";

      entryDlg.showModal();
    }

    btnCancel.addEventListener("click", ()=> entryDlg.close());
    btnDelete.addEventListener("click", async()=>{
      if(editDocRef){
        await deleteDoc(editDocRef);
      }
      entryDlg.close();
    });

    btnSave.addEventListener("click", async()=>{
      const payload = {
        title:  inTitle.value.trim(),
        note:   inNote.value.trim(),
        date:   inDate.value,
        status: inStatus.value,
        team:   inTeam.value.trim(),
        updatedAt: serverTimestamp()
      };
      if(!payload.title){
        alert("Bitte Titel eingeben.");
        return;
      }
      if(!payload.date){
        alert("Bitte Datum wählen.");
        return;
      }

      if(editDocRef){
        await updateDoc(editDocRef, payload);
      }else{
        payload.createdAt = serverTimestamp();
        await addDoc(collection(db,"plantafel"), payload);
      }

      entryDlg.close();
    });

    // ---------------------------
    // Stammdaten-Dialog
    // ---------------------------

    async function loadMasterData(){
      masterList.innerHTML = "Lade…";
      const snap = await getDocs(collection(db,"settings"));
      const rows = [];
      snap.forEach(s=>{
        const d = s.data();
        rows.push(`${d.type || "?"} – ${d.name || ""}`);
      });
      if(rows.length===0){
        masterList.textContent = "(keine Stammdaten vorhanden)";
      }else{
        masterList.innerHTML = rows.map(r=>`<div>- ${r}</div>`).join("");
      }
    }

    btnSettings.addEventListener("click", async()=>{
      await loadMasterData();
      masterDlg.showModal();
    });
    btnMasterClose.addEventListener("click", ()=> masterDlg.close());
    btnMasterCancel.addEventListener("click", ()=> masterDlg.close());

    btnMasterSave.addEventListener("click", async()=>{
      const t = mType.value;
      const n = mName.value.trim();
      if(!n){
        alert("Bitte Bezeichnung eingeben.");
        return;
      }
      await addDoc(collection(db,"settings"),{
        type: t,
        name: n,
        createdAt: serverTimestamp()
      });
      mName.value = "";
      await loadMasterData();
    });

    // ---------------------------
    // Toolbar Events
    // ---------------------------

    viewSel.addEventListener("change", ()=>{
      currentView = (viewSel.value==="4w"?"4w":viewSel.value==="2w"?"2w":"12m");
      buildBoard();
    });

    startDateInput.addEventListener("change", ()=>{
      // neues Startdatum übernehmen
      if(startDateInput.value){
        const parts = startDateInput.value.split("-");
        currentStart = new Date(+parts[0], +parts[1]-1, +parts[2]);
        buildBoard();
      }
    });

    btnReload.addEventListener("click", ()=>{
      buildBoard();
    });

    chkAuto.addEventListener("change", ()=>{
      if(chkAuto.checked){
        // alle 30 Sekunden neu laden
        autoReloadId = setInterval(buildBoard, 30000);
      }else{
        clearInterval(autoReloadId);
        autoReloadId = null;
      }
    });

    btnAdd.addEventListener("click", ()=>{
      openEntryDialog({
        title:"",
        note:"",
        date: ymd(new Date()),
        status:"normal",
        team:""
      }, null);
    });
    fabPlus.addEventListener("click", ()=>{
      openEntryDialog({
        title:"",
        note:"",
        date: ymd(new Date()),
        status:"normal",
        team:""
      }, null);
    });

    // Speziell Urlaub/Krank/Schule-Schalter:
    chkSpecial.addEventListener("change", ()=>{
      // hier könntest du filtern oder farbig hervorheben.
      // Im Moment lassen wir ihn optisch nur fürs Label stehen.
    });

    // ---------------------------
    // Start
    // ---------------------------
    buildBoard();
  </script>
</body>
</html>
