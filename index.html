<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Plantafel Dachdeckerei Frey</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --blue: #0b63c6;
      --blue-soft: #e8f1fb;
      --bg: #e6e6ea;
      --card: #ffffff;
      --line: #d0d0d4;
      --text: #0f172a;
      --text-dim: #4b5563;
      --radius: 10px;
      --dur: .15s;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
    }
    header {
      background: var(--blue);
      color: #fff;
      padding: .8rem 1rem .6rem;
      display: flex;
      flex-wrap: wrap;
      gap: .5rem;
      align-items: center;
    }
    header h1 {
      font-size: 1.15rem;
      margin: 0 1rem 0 0;
      white-space: nowrap;
    }
    .btn-tabs button {
      background: rgba(255,255,255,.12);
      color: #fff;
      border: 1px solid rgba(255,255,255,.25);
      border-radius: 7px;
      padding: .25rem .7rem;
      cursor: pointer;
      font-weight: 500;
    }
    .btn-tabs button.active {
      background: #fff;
      color: var(--blue);
    }
    select, input[type="date"] {
      border: 1px solid rgba(255,255,255,.4);
      background: rgba(255,255,255,.25);
      color: #fff;
      border-radius: 6px;
      padding: .25rem .4rem;
    }
    option { color: #000; }
    .btn {
      background: #fff;
      color: var(--blue);
      border: none;
      border-radius: 6px;
      padding: .35rem .75rem;
      font-weight: 500;
      cursor: pointer;
    }
    .btn.secondary {
      background: rgba(255,255,255,.15);
      color: #fff;
    }
    .status-dot {
      width: .55rem; height: .55rem;
      border-radius: 50%;
      display: inline-block;
      margin-left: .4rem;
    }
    main {
      padding: 1rem;
      min-height: calc(100vh - 120px);
    }
    .board {
      display: grid;
      gap: .75rem;
    }
    /* 14 Tage & 4 Wochen */
    .day-column {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      min-height: 120px;
      display: flex;
      flex-direction: column;
    }
    .day-head {
      padding: .4rem .5rem;
      border-bottom: 1px solid #e5e7eb;
      font-weight: 600;
      font-size: .8rem;
      background: #f1f5f9;
    }
    .day-list {
      flex: 1;
      padding: .4rem .4rem .5rem;
      display: flex;
      gap: .35rem;
      flex-direction: column;
      min-height: 70px;
    }
    .entry {
      border-radius: 7px;
      background: #f8fafc;
      border: 1px solid rgba(15,23,42,.03);
      padding: .25rem .4rem .35rem;
      font-size: .7rem;
      cursor: grab;
      box-shadow: 0 1px 0 rgba(15,23,42,.02);
    }
    .entry-title { font-weight: 600; }
    .entry-meta { font-size: .65rem; opacity: .95; }
    .entry small { display: block; }
    .badge {
      display: inline-block;
      font-size: .6rem;
      border-radius: 999px;
      padding: 0 .45rem;
      margin-right: .25rem;
      margin-bottom: .15rem;
    }
    /* 12 Monate */
    .months-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
      gap: .7rem;
    }
    .month-box {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      min-height: 180px;
      display: flex;
      flex-direction: column;
    }
    .month-head {
      padding: .4rem .5rem;
      background: #f1f5f9;
      border-bottom: 1px solid #e5e7eb;
      font-weight: 600;
      font-size: .8rem;
    }
    .month-body {
      padding: .4rem .4rem .5rem;
      display: flex;
      flex-direction: column;
      gap: .35rem;
      flex: 1;
    }
    dialog {
      border: none;
      border-radius: 14px;
      padding: 1rem 1rem 1.2rem;
      max-width: 440px;
      width: min(95vw,440px);
      background: #fff;
      box-shadow: 0 18px 60px rgba(15,23,42,.25);
    }
    dialog::backdrop {
      background: rgba(15,23,42,.35);
    }
    form label {
      display: block;
      font-size: .7rem;
      margin-top: .3rem;
      margin-bottom: .15rem;
      font-weight: 600;
    }
    input[type="text"], textarea, select, input[type="date"] {
      width: 100%;
      border: 1px solid #d0d4dd;
      border-radius: 6px;
      padding: .3rem .4rem;
      font-size: .75rem;
      background: #fff;
      color: #000;
    }
    select[multiple] {
      height: 80px;
    }
    textarea { min-height: 50px; resize: vertical; }
    .dialog-buttons {
      margin-top: .6rem;
      display: flex;
      justify-content: flex-end;
      gap: .4rem;
    }
    .pill {
      display: inline-block;
      padding: .25rem .45rem;
      border-radius: 999px;
      background: #eef2ff;
      font-size: .6rem;
      margin-bottom: .2rem;
    }
    .text-right { text-align: right; }

    @media (min-width: 1100px){
      .board.fourweeks { grid-template-columns: repeat(5, minmax(180px,1fr)); }
      .board.fourteen { grid-template-columns: repeat(7, minmax(140px,1fr)); }
    }
    @media (max-width: 1099px){
      .board.fourweeks,
      .board.fourteen {
        grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <header>
    <h1>Plantafel Dachdeckerei Frey</h1>
    <div class="btn-tabs" id="viewTabs">
      <button data-view="4w" class="active">4 Wochen</button>
      <button data-view="14d">14 Tage</button>
      <button data-view="12m">12 Monate</button>
    </div>
    <div style="margin-left:.5rem;">
      Start:
      <input type="date" id="startDate">
    </div>
    <button class="btn secondary" id="reloadBtn">Neu laden</button>
    <button class="btn secondary" id="stammdatenBtn">Stammdaten</button>
    <button class="btn" id="newEntryBtn">+ Eintrag</button>
    <span id="onlineDot" style="margin-left:auto; display:flex; align-items:center; gap:.35rem;">
      <span id="stateDot" class="status-dot" style="background:#ef4444;"></span>
      <span id="stateText" style="font-size:.65rem;">offline</span>
    </span>
  </header>
  <main>
    <div id="boardContainer"></div>
  </main>

  <!-- Dialog Neuer Eintrag -->
  <dialog id="entryDialog">
    <form id="entryForm" method="dialog">
      <h3 style="margin-top:0;">Neuer Eintrag</h3>
      <label>Baustelle / Auftrag
        <input type="text" id="fBaustelle" placeholder="z. B. Müller Dach" required />
      </label>
      <label>Von
        <input type="date" id="fVon" required />
      </label>
      <label>Bis (optional – wenn leer: 1 Tag)
        <input type="date" id="fBis" />
      </label>
      <label>Mitarbeiter (Mehrfachwahl mit Strg/Strg+Klick)
        <select id="fMitarbeiter" multiple></select>
      </label>
      <label>Fahrzeuge (Mehrfachwahl)
        <select id="fFahrzeuge" multiple></select>
      </label>
      <label>Status
        <select id="fStatus">
          <option value="">normal</option>
          <option value="Urlaub">Urlaub</option>
          <option value="Krank">Krank</option>
          <option value="Schule">Schule</option>
        </select>
      </label>
      <label>Notiz
        <textarea id="fNotiz" placeholder="optional"></textarea>
      </label>
      <input type="hidden" id="fId" />
      <div class="dialog-buttons">
        <button type="button" onclick="closeEntryDialog()">Abbrechen</button>
        <button type="submit" class="btn">Speichern</button>
      </div>
    </form>
  </dialog>

  <!-- Dialog Stammdaten -->
  <dialog id="stammDialog">
    <form id="stammForm" method="dialog">
      <h3 style="margin-top:0;">Stammdaten</h3>
      <p style="font-size:.7rem; margin-top:0;">Hier Mitarbeiter, Fahrzeuge, Baustellen verwalten.</p>
      <label>Neuer Mitarbeiter
        <input type="text" id="sMitarbeiter" placeholder="Name" />
      </label>
      <button type="button" class="btn" onclick="addStamm('mitarbeiter')">+ hinzufügen</button>
      <div id="listMitarbeiter" style="margin:.4rem 0 .7rem;"></div>
      <label>Neues Fahrzeug
        <input type="text" id="sFahrzeug" placeholder="z. B. Crafter Bus" />
      </label>
      <button type="button" class="btn" onclick="addStamm('fahrzeuge')">+ hinzufügen</button>
      <div id="listFahrzeuge" style="margin:.4rem 0 .7rem;"></div>
      <label>Baustelle für Grobplanung
        <input type="text" id="sBaustelle" placeholder="z. B. Müller Dach" />
      </label>
      <button type="button" class="btn" onclick="addStamm('baustellen')">+ hinzufügen</button>
      <div id="listBaustellen" style="margin:.4rem 0 .7rem;"></div>
      <div class="dialog-buttons">
        <button type="button" onclick="closeStammDialog()">Schließen</button>
      </div>
    </form>
  </dialog>

  <footer style="text-align:center; padding:.35rem; font-size:.65rem; background:#0b63c6; color:#fff;">
    © 2025 Dachdeckerei Frey – Digitale Plantafel
  </footer>

  <script>
    // ==== 1. SUPABASE VERBINDUNG ====
    const SUPABASE_URL = "https://mtybmrkyhavxpvwysglo.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10eWJtcmt5aGF2eHB2d3lzZ2xvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxNjQ1OTIsImV4cCI6MjA3Nzc0MDU5Mn0.UToAmJAvACYvnO9hCIeyfm-VYKr5jincXdnEDDtbhvo";
    const supa = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // globale Daten
    let mitarbeiter = [];
    let fahrzeuge = [];
    let baustellen = [];
    let eintraege = [];

    // Farben für Mitarbeiter fest vergeben
    const colorPool = [
      "#10b981", "#6366f1", "#f97316", "#ec4899",
      "#14b8a6", "#f59e0b", "#0ea5e9", "#a855f7",
      "#ef4444", "#22c55e", "#0f766e", "#0369a1",
      "#ea580c", "#e11d48", "#6d28d9", "#facc15",
    ];
    const mitarbeiterColorMap = {}; // name -> farbe

    function pickColorFor(name, i) {
      if (mitarbeiterColorMap[name]) return mitarbeiterColorMap[name];
      const idx = typeof i === "number" ? i % colorPool.length : Object.keys(mitarbeiterColorMap).length % colorPool.length;
      const col = colorPool[idx];
      mitarbeiterColorMap[name] = col;
      return col;
    }

    // ==== 2. UI INITIAL ====
    const boardContainer = document.getElementById("boardContainer");
    const startDateInput = document.getElementById("startDate");
    const stateDot = document.getElementById("stateDot");
    const stateText = document.getElementById("stateText");

    // Standard: heutiges Datum
    const today = new Date();
    startDateInput.value = today.toISOString().slice(0,10);

    // View Buttons
    const viewTabs = document.getElementById("viewTabs");
    let currentView = "4w";

    viewTabs.addEventListener("click", (e) => {
      if (e.target.tagName === "BUTTON") {
        viewTabs.querySelectorAll("button").forEach(b => b.classList.remove("active"));
        e.target.classList.add("active");
        currentView = e.target.dataset.view;
        renderBoard();
      }
    });

    document.getElementById("reloadBtn").addEventListener("click", loadAll);
    document.getElementById("newEntryBtn").addEventListener("click", openEntryDialog);
    document.getElementById("stammdatenBtn").addEventListener("click", openStammDialog);
    startDateInput.addEventListener("change", renderBoard);

    // ==== 3. LADEN ALLES ====
    async function loadAll() {
      try {
        // Stammdaten laden
        const { data: mData, error: mErr } = await supa.from("mitarbeiter").select().order("name");
        const { data: fData, error: fErr } = await supa.from("fahrzeuge").select().order("name");
        const { data: bData, error: bErr } = await supa.from("baustellen").select().order("name");

        if (mErr || fErr || bErr) throw new Error("Stammdaten-Fehler");

        mitarbeiter = mData || [];
        fahrzeuge = fData || [];
        baustellen = bData || [];

        // Farben vorbereiten
        mitarbeiter.forEach((m, idx)=>pickColorFor(m.name, idx));

        // Einträge laden
        await loadEntries();

        stateDot.style.background = "#22c55e";
        stateText.textContent = "verbunden";
      } catch (err) {
        console.warn("Laden fehlgeschlagen:", err);
        stateDot.style.background = "#ef4444";
        stateText.textContent = "offline";
        // trotzdem rendern, evtl. ist was im Array
        renderBoard();
      }
      renderStammListen();
    }

    async function loadEntries() {
      // wir holen alle und filtern im Frontend nach Zeitraum
      const { data, error } = await supa.from("plantafel").select().order("tag");
      if (error) {
        console.warn(error);
        return;
      }
      eintraege = data || [];
      renderBoard();
    }

    // ==== 4. BOARD RENDERN ====
    function renderBoard() {
      const start = new Date(startDateInput.value);
      if (isNaN(start)) return;
      boardContainer.innerHTML = "";

      if (currentView === "12m") {
        renderMonths(start);
      } else if (currentView === "14d") {
        renderDays(start, 14);
      } else {
        // 4 Wochen Mo-Fr
        renderWeeks(start, 4);
      }
    }

    function renderDays(startDate, dayCount) {
      const wrap = document.createElement("div");
      wrap.className = "board fourteen";
      for (let i=0; i<dayCount; i++){
        const d = new Date(startDate);
        d.setDate(d.getDate() + i);
        const dayBox = buildDayBox(d);
        wrap.appendChild(dayBox);
      }
      boardContainer.appendChild(wrap);
    }

    function renderWeeks(startDate, weekCount) {
      const wrap = document.createElement("div");
      wrap.className = "board fourweeks";
      // start auf Montag schieben
      const s = new Date(startDate);
      const day = s.getDay();
      const diff = (day === 0 ? 6 : day-1); // 1=Mo
      s.setDate(s.getDate() - diff);
      for (let w=0; w<weekCount; w++){
        for (let wd=0; wd<5; wd++){
          const d = new Date(s);
          d.setDate(d.getDate() + w*7 + wd);
          const dayBox = buildDayBox(d);
          wrap.appendChild(dayBox);
        }
      }
      boardContainer.appendChild(wrap);
    }

    function renderMonths(startDate){
      const wrap = document.createElement("div");
      wrap.className = "months-grid";
      const s = new Date(startDate);
      s.setDate(1);
      for (let m=0; m<12; m++){
        const d = new Date(s);
        d.setMonth(d.getMonth()+m);
        const mBox = document.createElement("div");
        mBox.className = "month-box";
        const head = document.createElement("div");
        head.className = "month-head";
        const monthName = d.toLocaleString("de-DE",{month:"long",year:"numeric"});
        head.textContent = monthName;
        const body = document.createElement("div");
        body.className = "month-body";
        // Einträge dieses Monats
        const monthEntries = eintraege.filter(e=>{
          const ed = new Date(e.tag);
          return ed.getFullYear() === d.getFullYear() && ed.getMonth() === d.getMonth();
        });
        monthEntries.forEach(e=>{
          body.appendChild(buildEntryCard(e, true));
        });
        mBox.appendChild(head);
        mBox.appendChild(body);
        wrap.appendChild(mBox);
      }
      boardContainer.appendChild(wrap);
    }

    function buildDayBox(dateObj) {
      const dayBox = document.createElement("div");
      dayBox.className = "day-column";
      dayBox.dataset.date = dateObj.toISOString().slice(0,10);
      dayBox.ondragover = (ev)=>ev.preventDefault();
      dayBox.ondrop = (ev)=>{
        ev.preventDefault();
        const id = ev.dataTransfer.getData("entry-id");
        if (id) moveEntryToDate(id, dayBox.dataset.date);
      };

      const head = document.createElement("div");
      head.className = "day-head";
      head.textContent = dateObj.toLocaleString("de-DE",{weekday:"short", day:"2-digit", month:"2-digit", year:"numeric"});
      const list = document.createElement("div");
      list.className = "day-list";

      const dateStr = dateObj.toISOString().slice(0,10);
      const items = eintraege.filter(e=>e.tag===dateStr).sort((a,b)=>(a.sort||0)-(b.sort||0));
      items.forEach(e=>{
        list.appendChild(buildEntryCard(e,false));
      });

      dayBox.appendChild(head);
      dayBox.appendChild(list);
      return dayBox;
    }

    function buildEntryCard(e, compact){
      const div = document.createElement("div");
      div.className = "entry";
      div.draggable = true;
      div.dataset.id = e.id;
      div.ondragstart = (ev)=>{
        ev.dataTransfer.setData("entry-id", e.id);
      };
      // Farbe
      let bg = "#f8fafc";
      if (e.status === "Urlaub") bg = "#facc15";
      else if (e.status === "Krank") bg = "#f43f5e";
      else if (e.status === "Schule") bg = "#38bdf8";
      else if (e.mitarbeiter) {
        const first = e.mitarbeiter.split(",")[0].trim();
        if (first) bg = pickColorFor(first);
      }
      div.style.background = bg;
      div.style.color = "#fff";
      div.style.border = "none";

      const title = document.createElement("div");
      title.className = "entry-title";
      title.textContent = e.titel || "(ohne Titel)";
      div.appendChild(title);

      const meta = document.createElement("div");
      meta.className = "entry-meta";
      const mit = e.mitarbeiter ? e.mitarbeiter.split(",").map(x=>x.trim()).filter(Boolean) : [];
      if (mit.length){
        const mspan = document.createElement("div");
        mspan.textContent = mit.join(", ");
        meta.appendChild(mspan);
      }
      const fahr = e.fahrzeug ? e.fahrzeug.split(",").map(x=>x.trim()).filter(Boolean) : [];
      if (fahr.length){
        const fspan = document.createElement("div");
        fspan.textContent = fahr.join(", ");
        meta.appendChild(fspan);
      }
      if (e.status){
        const sspan = document.createElement("div");
        sspan.textContent = e.status;
        meta.appendChild(sspan);
      }
      if (!compact && e.notiz){
        const nspan = document.createElement("div");
        nspan.textContent = e.notiz;
        meta.appendChild(nspan);
      }
      div.appendChild(meta);

      div.onclick = ()=>openEntryDialog(e);
      return div;
    }

    // ==== 5. EINTRAG VERSCHIEBEN ====
    async function moveEntryToDate(id, newDate){
      const entry = eintraege.find(x=>x.id===id);
      if (!entry) return;
      // DB updaten
      const { error } = await supa.from("plantafel").update({ tag: newDate }).eq("id", id);
      if (error) {
        alert("Konnte nicht verschieben (DB).");
        return;
      }
      entry.tag = newDate;
      renderBoard();
    }

    // ==== 6. EINTRAG DIALOG ====
    const entryDialog = document.getElementById("entryDialog");
    const entryForm = document.getElementById("entryForm");
    function openEntryDialog(entry){
      // Stammlisten bestücken
      fillSelects();

      if (entry){
        document.getElementById("fId").value = entry.id;
        document.getElementById("fBaustelle").value = entry.titel || "";
        document.getElementById("fVon").value = entry.tag;
        document.getElementById("fBis").value = entry.tag; // nur 1 tag gespeichert
        document.getElementById("fStatus").value = entry.status || "";
        document.getElementById("fNotiz").value = entry.notiz || "";
        // multi selects setzen
        setMultiSelect(document.getElementById("fMitarbeiter"), entry.mitarbeiter);
        setMultiSelect(document.getElementById("fFahrzeuge"), entry.fahrzeug);
      } else {
        document.getElementById("fId").value = "";
        document.getElementById("fBaustelle").value = "";
        document.getElementById("fVon").value = startDateInput.value;
        document.getElementById("fBis").value = "";
        document.getElementById("fStatus").value = "";
        document.getElementById("fNotiz").value = "";
        setMultiSelect(document.getElementById("fMitarbeiter"), "");
        setMultiSelect(document.getElementById("fFahrzeuge"), "");
      }
      entryDialog.showModal();
    }
    function closeEntryDialog(){
      entryDialog.close();
    }
    entryForm.addEventListener("submit", async (ev)=>{
      ev.preventDefault();
      const id = document.getElementById("fId").value;
      const titel = document.getElementById("fBaustelle").value.trim();
      const von = document.getElementById("fVon").value;
      const bis = document.getElementById("fBis").value;
      const status = document.getElementById("fStatus").value;
      const notiz = document.getElementById("fNotiz").value.trim();
      const mitSel = getMultiSelect(document.getElementById("fMitarbeiter"));
      const fahrSel = getMultiSelect(document.getElementById("fFahrzeuge"));

      const payload = {
        titel,
        tag: von,
        mitarbeiter: mitSel.join(", "),
        fahrzeug: fahrSel.join(", "),
        status,
        notiz
      };

      let dbErr = null;
      if (id){
        const { error } = await supa.from("plantafel").update(payload).eq("id", id);
        dbErr = error;
      } else {
        const { error } = await supa.from("plantafel").insert(payload);
        dbErr = error;
      }
      if (dbErr) {
        alert("Speichern fehlgeschlagen.");
      }
      closeEntryDialog();
      loadEntries();
    });

    function fillSelects(){
      const mSel = document.getElementById("fMitarbeiter");
      const fSel = document.getElementById("fFahrzeuge");
      mSel.innerHTML = "";
      mitarbeiter.forEach(m=>{
        const opt = document.createElement("option");
        opt.value = m.name;
        opt.textContent = m.name;
        mSel.appendChild(opt);
      });
      fSel.innerHTML = "";
      fahrzeuge.forEach(f=>{
        const opt = document.createElement("option");
        opt.value = f.name;
        opt.textContent = f.name;
        fSel.appendChild(opt);
      });
    }
    function setMultiSelect(sel, csv){
      const items = (csv||"").split(",").map(x=>x.trim()).filter(Boolean);
      Array.from(sel.options).forEach(o=>{
        o.selected = items.includes(o.value);
      });
    }
    function getMultiSelect(sel){
      return Array.from(sel.selectedOptions).map(o=>o.value);
    }

    // ==== 7. STAMMDATEN ====
    const stammDialog = document.getElementById("stammDialog");
    function openStammDialog(){
      renderStammListen();
      stammDialog.showModal();
    }
    function closeStammDialog(){
      stammDialog.close();
    }
    async function addStamm(kind){
      let inputId = "";
      let table = "";
      if (kind==="mitarbeiter"){ inputId="sMitarbeiter"; table="mitarbeiter";}
      else if (kind==="fahrzeuge"){ inputId="sFahrzeug"; table="fahrzeuge";}
      else { inputId="sBaustelle"; table="baustellen";}

      const val = document.getElementById(inputId).value.trim();
      if (!val) return;

      const { error } = await supa.from(table).insert({ name: val });
      if (error) { alert("Konnte nicht speichern."); return; }
      document.getElementById(inputId).value = "";
      loadAll();
    }
    function renderStammListen(){
      const lm = document.getElementById("listMitarbeiter");
      const lf = document.getElementById("listFahrzeuge");
      const lb = document.getElementById("listBaustellen");
      lm.innerHTML = "";
      mitarbeiter.forEach(m=>{
        const d = document.createElement("div");
        d.innerHTML = `<span class="pill" style="background:${pickColorFor(m.name)};color:#fff;">${m.name}</span> <button type="button" style="font-size:.6rem" onclick="delStamm('mitarbeiter','${m.id}')">x</button>`;
        lm.appendChild(d);
      });
      lf.innerHTML = "";
      fahrzeuge.forEach(f=>{
        const d = document.createElement("div");
        d.innerHTML = `<span class="pill">${f.name}</span> <button type="button" style="font-size:.6rem" onclick="delStamm('fahrzeuge','${f.id}')">x</button>`;
        lf.appendChild(d);
      });
      lb.innerHTML = "";
      baustellen.forEach(b=>{
        const d = document.createElement("div");
        d.innerHTML = `<span class="pill" style="background:#f97316;color:#fff;">${b.name}</span> <button type="button" style="font-size:.6rem" onclick="delStamm('baustellen','${b.id}')">x</button>`;
        lb.appendChild(d);
      });
    }
    async function delStamm(table, id){
      const { error } = await supa.from(table).delete().eq("id", id);
      if (error){ alert("Löschen nicht möglich."); return; }
      loadAll();
    }

    // ==== 8. START ====
    loadAll();
  </script>
</body>
</html>
