<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dachdeckerei Frey – Digitale Plantafel</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f6f6f4;
      --card: #ffffff;
      --line: #dcdcdc;
      --text: #222;
      --accent: #b12a2a;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Inter", sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      background: var(--card);
      border-bottom: 1px solid var(--line);
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    h1 { margin: 0; font-size: 20px; font-weight: 600; }
    main {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }
    button {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover { opacity: .9; }
    .view-select {
      display: flex;
      gap: 10px;
    }
    .board {
      display: grid;
      gap: 8px;
    }
    .day {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 8px;
      min-height: 80px;
      padding: 6px;
      cursor: pointer;
    }
    .entry {
      border-radius: 6px;
      padding: 4px 6px;
      margin: 2px 0;
      color: #fff;
      font-size: 13px;
      font-weight: 600;
    }
    .dialog {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.45);
      display: none;
      align-items: center;
      justify-content: center;
    }
    .dialog.active { display: flex; }
    .dialog-content {
      background: var(--card);
      border-radius: 10px;
      padding: 20px;
      width: 320px;
      box-shadow: 0 3px 10px rgba(0,0,0,.2);
    }
    label { display:block; margin-top:10px; font-weight:600; }
    input, select {
      width:100%; padding:6px; border:1px solid var(--line);
      border-radius:6px; font-size:14px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Plantafel Dachdeckerei Frey</h1>
    <div class="view-select">
      <button id="btn14">14 Tage</button>
      <button id="btn4w">4 Wochen</button>
      <button id="btn12m">12 Monate</button>
    </div>
  </header>
  <main id="board"></main>

  <!-- Dialog für Eintrag -->
  <div class="dialog" id="dialog">
    <div class="dialog-content">
      <h3 id="dlg-title">Neuer Eintrag</h3>
      <label>Typ</label>
      <select id="type">
        <option value="baustelle">Baustelle</option>
        <option value="fahrzeug">Fahrzeug</option>
        <option value="mitarbeiter">Mitarbeiter</option>
        <option value="status">Krank/Urlaub/Schule</option>
      </select>
      <label>Bezeichnung</label>
      <input id="title" placeholder="z. B. Dach Müller">
      <label>Von</label>
      <input type="date" id="from">
      <label>Bis</label>
      <input type="date" id="to">
      <div style="margin-top:14px;display:flex;justify-content:space-between;">
        <button id="save">Speichern</button>
        <button id="cancel" style="background:#666;">Abbrechen</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    const supabaseUrl = "https://mtybmrkyhavxpvwysglo.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10eWJtcmt5aGF2eHB2d3lzZ2xvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxNjQ1OTIsImV4cCI6MjA3Nzc0MDU5Mn0.UToAmJAvACYvnO9hCIeyfm-VYKr5jincXdnEDDtbhvo";
    export const supabase = createClient(supabaseUrl, supabaseKey);
    const board = document.getElementById("board");
    const dialog = document.getElementById("dialog");
    const saveBtn = document.getElementById("save");
    const cancelBtn = document.getElementById("cancel");
    cancelBtn.onclick = ()=>dialog.classList.remove("active");

    document.getElementById("btn14").onclick=()=>renderDays(14);
    document.getElementById("btn4w").onclick=()=>renderDays(28);
    document.getElementById("btn12m").onclick=()=>renderMonths();

    async function renderDays(days){
      board.innerHTML="";
      board.style.gridTemplateColumns="repeat(5,1fr)";
      const today=new Date();
      for(let i=0;i<days;i++){
        const d=new Date(today);
        d.setDate(today.getDate()+i);
        if(d.getDay()==6||d.getDay()==0)continue; // skip weekend
        const cell=document.createElement("div");
        cell.className="day";
        cell.dataset.date=d.toISOString().split("T")[0];
        cell.innerHTML=`<strong>${d.toLocaleDateString("de-DE",{weekday:"short",day:"2-digit",month:"2-digit"})}</strong>`;
        cell.onclick=()=>openDialog(cell.dataset.date);
        board.appendChild(cell);
      }
    }

    function renderMonths(){
      board.innerHTML="";
      board.style.gridTemplateColumns="repeat(4,1fr)";
      const months=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];
      for(let i=0;i<12;i++){
        const cell=document.createElement("div");
        cell.className="day";
        cell.dataset.month=i+1;
        cell.innerHTML=`<strong>${months[i]}</strong>`;
        board.appendChild(cell);
      }
    }

    function openDialog(date){
      dialog.classList.add("active");
      document.getElementById("from").value=date;
      document.getElementById("to").value=date;
      saveBtn.onclick=()=>saveEntry(date);
    }

    async function saveEntry(date){
      const data={
        type:document.getElementById("type").value,
        title:document.getElementById("title").value,
        from:document.getElementById("from").value,
        to:document.getElementById("to").value
      };
      await supabase.from("plantafel").insert(data);
      dialog.classList.remove("active");
      renderDays(14);
    }
  </script>
