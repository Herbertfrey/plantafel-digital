<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plantafel Dachdeckerei Frey</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f0f0; }
    header { background:#0075c9; color:white; padding:20px; font-size:28px; font-weight:bold; }
    #container { padding:20px; }
    .section { background:white; padding:20px; margin-bottom:20px; border-radius:8px; }
    .btn { padding:10px 20px; background:#0075c9; color:white; border:none; cursor:pointer; border-radius:5px; }
    .btn:hover { background:#005a99; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border:1px solid #ccc; padding:8px; }
    th { background:#eaeaea; }
    .status-normal { background:#0075c9; color:white; }
    .status-urlaub, .status-krank, .status-schule { background:#cc0000; color:white; }
    .status-fahrzeug { background:#777; color:white; }
    .status-aussendarstellung { background:#009900; color:white; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <header>Plantafel Dachdeckerei Frey</header>
  <div id="container">

    <div class="section">
      <h2>Eintr√§ge</h2>
      <table id="entriesTable">
        <thead>
          <tr>
            <th>Von</th>
            <th>Bis</th>
            <th>Titel</th>
            <th>Baustelle</th>
            <th>Mitarbeiter</th>
            <th>Fahrzeug</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="section">
      <h2>Neuer Eintrag</h2>
      <label>Von: <input type="date" id="von"></label><br><br>
      <label>Bis: <input type="date" id="bis"></label><br><br>
      <label>Titel: <input type="text" id="titel"></label><br><br>
      <label>Baustelle: <input type="text" id="baustelle"></label><br><br>
      <label>Mitarbeiter: <input type="text" id="mitarbeiter"></label><br><br>
      <label>Fahrzeug: <input type="text" id="fahrzeug"></label><br><br>
      <label>Status: <input type="text" id="status"></label><br><br>
      <button class="btn" id="saveBtn">Speichern</button>
    </div>

  </div>

<script>
const supabase = window.supabase.createClient(
  "https://mtbymnkayhvapwvpsgho.supabase.co",
  "sb_publishable_0w8pZ5pEAxxlv9Ke6dcurg_OuA14q7r"
);

async function loadEntries() {
  const { data, error } = await supabase.from("plantafel").select("*").order("von", { ascending: true });
  if (error) { console.error(error); return; }

  const tbody = document.querySelector("#entriesTable tbody");
  tbody.innerHTML = "";

  data.forEach(row => {
    const tr = document.createElement("tr");
    tr.classList.add(`status-${row.status || 'normal'}`);
    tr.innerHTML = `
      <td>${row.von || ''}</td>
      <td>${row.bis || ''}</td>
      <td>${row.titel || ''}</td>
      <td>${row.baustelle || ''}</td>
      <td>${row.mitarbeiter || ''}</td>
      <td>${row.fahrzeug || ''}</td>
      <td>${row.status || ''}</td>
    `;
    tbody.appendChild(tr);
  });
}

async function saveEntry() {
  const von = document.getElementById("von").value;
  const bis = document.getElementById("bis").value;
  const titel = document.getElementById("titel").value;
  const baustelle = document.getElementById("baustelle").value;
  const mitarbeiter = document.getElementById("mitarbeiter").value;
  const fahrzeug = document.getElementById("fahrzeug").value;
  const status = document.getElementById("status").value;

  const { error } = await supabase.from("plantafel").insert({
    von, bis, titel, baustelle, mitarbeiter, fahrzeug, status
  });

  if (error) {
    alert("Fehler beim Speichern: " + error.message);
    console.error(error);
  } else {
    alert("Eintrag gespeichert!");
    await loadEntries();
  }
}

document.getElementById("saveBtn").addEventListener("click", saveEntry);
loadEntries();
</script>

</body>
</html>
